## version: $Id:  $

<!-- sakai_resources_list.vm, use with org.sakaiproject.content.tool.ResourcesAction.java -->
<!-- this is the new list template, which uses the resources type registry -->
<!--[if gt IE 5.0]><![if lt IE 7]>
<style type="text/css">
/* that IE 5+ conditional comment makes this only visible in IE 5+*/ 
ul.makeMenu ul {  /* copy of above declaration without the > selector */                                                                      
  display: none; position: absolute; top: 18px; left: 0px; background-image:none; background-color:#ffffff;width: 15em; z-index:3;border:1px solid  #666  	
}
ul.makeMenu ul li {display:block}


</style>
<![endif]><![endif]-->
<!--[if gt IE 6.0]><![if lt IE 8]>
<style type="text/css">
ul.makeMenu li {
  padding:2px; 
  position: relative;
  display:inline;
}
	.menuOpen{border:1px solid #ccc;padding:1px;	background:#eee }
	.menuOpen:hover{border:1px solid #aaa;background:#ddd }
	ul.makeMenu{height:1em;padding:0;margin:3px 0; !important;border:1px solid transparent}
	ul.makeMenu:hover{border:1px solid transparent !important;padding:0;margin:0}
	ul.makeMenu ul{top: 15px !important;left:0}
	 .attach{width:1em !important;padding-bottom:.7em !important}

</style>
<![endif]><![endif]-->

#**#
<script type ="text/javascript" src ="/library/js/jquery.js">
<!-- // -->
</script>
<script  type ="text/javascript">
$(document).ready(function() {
	jQuery('.portletBody').click(function(e) { 
			
		if ( e.target.className !='menuOpen' &&e.target.className !='dropdn'  ){
			$('.makeMenuChild').hide();
		}
			else
			{
				if( e.target.className =='dropdn' ){
			targetId=$(e.target).parent('li').attr('id');
			$('.makeMenuChild').hide();
			$('#menu-' + targetId).show();

}
				else{
			targetId=e.target.id;
			$('.makeMenuChild').hide();
			$('#menu-' + targetId).show();
			}}
	});
	$('.toggleDescription').click(function(e){
	    e.preventDefault();
	    $('.descPanel').css({
	        'top': '-1000px',
	        'left': '-1000px',
	        'display': 'none'
	    }).attr({
	        'aria-hidden': 'true',
	        'tabindex': '-1'
	    });
	    $(this).next('div').css({
	        'top': e.pageY + 10,
	        'left': e.pageX + 10,
	        'cursor': 'pointer',
	        'display': 'block'
	    }).attr({
	        'aria-hidden': 'false',
	        'tabindex': '0'
	    });
	});
	$('.descPanel').blur(function(){
	    $(this).css({
	        'top': '-1000px',
	        'left': '-1000px',
	        'display': 'none'
	    }).attr({
	        'aria-hidden': 'true',
	        'tabindex': '-1'
	    });
	});
	$('.descPanel').click(function(){
	    $(this).css({
	        'top': '-1000px',
	        'left': '-1000px',
	        'display': 'none'
	    }).attr({
	        'aria-hidden': 'true',
	        'tabindex': '-1'
	    });
	});
	});
</script>
#**#
#set($num = 0)
<div class="portletBody specialLink" role="application">
	#set($itemsOnLine = 0)
	#if ($atHome && $atHome == $TRUE)
			<ul class="navIntraTool actionToolBar">
				<li class="firstToolBarItem"><span class="current">$tlang.getString("list.site")</span></li>
				<li><span><a href="#toolLink("ResourcesAction" "doShow_webdav")" title="$tlang.getString('dav.webdav')">$tlang.getString("dav.webdav")</a></span></li>
				#if($showPermissions)
				<li><span><a href="#toolLinkParam("ResourcesAction" "doPermissions" "collectionId=$validator.escapeUrl(${site.id})")" title="$clang.getString('list.sPerm')">$clang.getString("list.sPerm")</a></span></li>
				#end
				#if($showOptions)
				<li><span><a href="#toolLinkParam("ResourcesAction" "doOptions" "siteId=$validator.escapeUrl(${site.id})")" title="$clang.getString('list.options')">$clang.getString("list.options")</a></span></li>
				#end
				#if($showDropboxOptions)
				<li><span><a href="#toolLinkParam("ResourcesAction" "doDropboxOptions" "siteId=$validator.escapeUrl(${site.id})")" title="$clang.getString('list.options')">$clang.getString("list.options")</a></span></li>
				#end
				#if($showQuota)
				<li><span><a href="#toolLinkParam("ResourcesAction" "doShowQuota" "siteId=$validator.escapeUrl(${site.id})")" title="$clang.getString('list.quota')">$clang.getString("list.quota")</a></span></li>
				#end
			</ul>
	#end 
	#if ($alertMessage)
		<br /><div class="alertMessage">$clang.getString("gen.alert") $validator.escapeHtml($alertMessage)</div><div class="clear" ></div>
	#end
	<form name="showForm" id="showForm" action="#toolForm("ResourcesAction")" method="post">
		<input type="hidden" name="source" id="source" value="0" />
		<input type="hidden" name="collectionId" id="collectionId" value="$validator.escapeHtml($collectionId)" />
		<input type="hidden" name="navRoot" id="navRoot" value="" />
		<input type="hidden" name="criteria" id="criteria" value="title" />
		<input type="hidden" name="sakai_action" id="sakai_action" value="" />
		<input type="hidden" name="rt_action" id="rt_action" value="" />
		<input type="hidden" name="selectedItemId" id="selectedItemId" value="" />
		######################  Page Title / Breadcrumbs  ##############
		<div class ="breadCrumb specialLink">
			<h3>
				$tlang.getString("gen.location")
				<img src = "#imageLink($contentTypeImageService.getContentTypeImage("folder"))" border="0"  alt="folder" />
				#foreach ($item in $collectionPath)
					#set($qid=$item.id.replaceAll("'","\\'").replaceAll("\"", "&quot;"))
					#if($item.isLast())
						$validator.escapeHtml("$item.name")
						#if($upOneLevel)
							<a href="#"
								onclick="javascript:document.getElementById('sakai_action').value='doNavigate';document.getElementById('collectionId').value='$upOneLevel.id';document.getElementById('navRoot').value='$upOneLevel.root';document.getElementById('showForm').submit();"
								title= "$tlang.getString('sh.one')">
							##<a href="#toolLinkParam("ResourcesAction" "doNavigate" "collectionId=$validator.escapeUrl($upOneLevel.id)&navRoot=$validator.escapeUrl($upOneLevel.root)")" title= "$tlang.getString('sh.one')">
								<img src="/library/image/sakai/onelevelup.gif" border="0" alt ="$tlang.getString('sh.one')"/>
							</a>
						#end
					#elseif($item.canRead())
						<a href="#" 
							onclick="javascript:document.getElementById('sakai_action').value='doNavigate';document.getElementById('collectionId').value='$qid';document.getElementById('navRoot').value='$item.root';document.getElementById('showForm').submit();"
							title= "$tlang.getString('sh.go')">
							$validator.escapeHtml("$item.name")
						</a> /
						#set($upOneLevel = $item)
					#else
						$validator.escapeHtml("$item.name")
					#end
				#end
			</h3>
		</div>	
		#if($showDropboxGroupFilter)
		<div>	
		    <span class="instruction">
                $tlang.getString("grp.view"): 
            </span> 
            <select name="dropboxGroupFilter_groupId" id="dropboxGroupFilter_groupId" onchange="javascript:document.getElementById('sakai_action').value='doSetDropboxGroupIdFilter';document.getElementById('showForm').submit();">
                <option value=""#if($!dropboxGroupFilter_groupId || $dropboxGroupFilter_groupId.equals("")) selected="selected"#end>$tlang.getString("grp.all")</option>
                #foreach($group in $dropboxGroupFilter_groups)
                    <option value="$group.getId()"#if($group.getId().equals($dropboxGroupFilter_groupId)) selected="selected"#end>$group.getTitle()</option>
                #end
            </select>
        </div>
        #end		
		#if($listActions || $showHotDropboxWidget)
			<div class="navPanel">
				<div class="navIntraToolLink viewNav">
					#if($listActions)
						<span>
							#set ($itemsOnLine = 0)
							#foreach($key in $listActions.keySet())
								#set($action = $listActions.get("$key"))
								#if($itemsOnLine > 0)|#end
								<input id="${action.id}-button" type="button" value="$!action.label"
									onclick="javascript:document.getElementById('sakai_action').value='doMultiItemDispatch';document.getElementById('rt_action').value='$action.id';document.getElementById('showForm').submit();"
									disabled="disabled" alt="$!action.id" />
								
								#set ($itemsOnLine = $itemsOnLine + 1)
							#end
						</span>
					#end
				</div>
				#if($showHotDropboxWidget)
					<div class="listNav">
						<span class="instruction">
 							$clang.getString("dropbox_highlight")
						</span>	
						<select name="dropboxHighlight" id="dropboxHighlight" onchange="javascript:document.getElementById('sakai_action').value='doSetHotDropbox';document.getElementById('showForm').submit();">
 							<option value="1"#if("$!dropboxHighlight" == "1") selected="selected"#end>$clang.getString("sh.1day")</option>
 							<option value="2"#if("$!dropboxHighlight" == "2") selected="selected"#end>$clang.getString("sh.2day")</option>
 							<option value="3"#if("$!dropboxHighlight" == "3") selected="selected"#end>$clang.getString("sh.3day")</option>
 							<option value="7"#if("$!dropboxHighlight" == "7") selected="selected"#end>$clang.getString("sh.1week")</option>
						</select>
					</div>
				#end
			</div>	
		#end
				
		######################  Heirarchical list of resource folders/items  ##############
		<table class="listHier lines centerLines" cellspacing="0" border="0"  summary="$clang.getString("sh.listsum")">
			######################  Column labels, sort controls, expand/collapse all  ##############
			<caption class="skip"  style="display:none">$clang.getString("sh.listcap")</caption>
			<tr>
				<th id="expansion" style="border:none">
					#if ($expandallflag && "$expandallflag" == "$TRUE")
						<a href="javascript:document.getElementById('sakai_action').value='doUnexpandall';document.getElementById('collectionId').value='$collectionId';document.getElementById('showForm').submit();"
							title= "$clang.getString('collapseall')">
							<img src = "#imageLink("sakai/collapse-expand.gif")" border="0" title="$clang.getString('collapseall')" alt="$clang.getString('collapseall')" hspace="0" />
						</a>								 
					#else
						<a href="javascript:document.getElementById('sakai_action').value='doExpandall';document.getElementById('collectionId').value='$collectionId';document.getElementById('showForm').submit();"
							title= "$slang.getString('label.expand.all')">
							<img src = "#imageLink("sakai/expand-collapse.gif")" border="0" title="$slang.getString('label.expand.all')" alt="$slang.getString('label.expand.all')" hspace="0" />
						</a>								 
					#end
				</th>
				<th id="checkboxes"  style="border:none">
						<input type="checkbox" name="selectall" id="selectall" disabled="disabled" title="$clang.getString("list.select")"
							onclick="javascript:toggleSelectAll(this, 'selectedMembers')" value="" /><label for="selectall" class="skip">$clang.getString("list.select")</label>
				</th>
				<th id="title"  style="border:none">
					<a href="javascript:document.getElementById('sakai_action').value='doSort';document.getElementById('collectionId').value='$collectionId';document.getElementById('criteria').value='title';document.getElementById('showForm').submit();"
						title= "$clang.getString('sh.sorttit')">
						$clang.getString("gen.title1")
						#if ($currentSortedBy.equals($resourceProperties.NamePropDisplayName)) 
							#if ($currentSortAsc.equals("true")) 
								<img src = "#imageLink("sakai/sortascending.gif")" border="0" title ="$clang.getString('sh.sorttitas')" alt ="$clang.getString('sh.sorttitas')" /> 
							#else 
								<img src = "#imageLink("sakai/sortdescending.gif")" border="0" title ="$clang.getString('sh.sorttitdesc')" alt ="$clang.getString('sh.sorttitdesc')" /> 
							#end 
						#end 
					</a>
				</th>
				<th id="actions1" class="attach"  style="border:none">
					##$tlang.getString("gen.actions")
				</th>
				<th id="actions2"    style="border:none">
					##$tlang.getString("gen.actions")
				</th>
				<th id="actions3"    style="border:none">
					##$tlang.getString("gen.actions")
				</th>
				<th id="access"  style="border:none">
					$clang.getString("gen.access")
				</th>
				<th id="creator"  style="border:none">
					<a href="javascript:document.getElementById('sakai_action').value='doSort';document.getElementById('collectionId').value='$collectionId';document.getElementById('criteria').value='created by';document.getElementById('showForm').submit();"
						title= "$clang.getString('sh.sortaut')">
						$clang.getString("gen.created")
						#if ($currentSortedBy.equals($resourceProperties.NamePropCreator)) 
							#if ($currentSortAsc.equals("true")) 
								<img src = "#imageLink("sakai/sortascending.gif")" border="0"  title ="$clang.getString('sh.sortautas')"  alt ="$clang.getString('sh.sortautas')" /> 
							#else 
								<img src = "#imageLink("sakai/sortdescending.gif")" border="0" title ="$clang.getString('sh.sortautdesc')"  alt ="$clang.getString('sh.sortautdesc')" /> 
							#end 
						#end 
					</a>
				</th>
				<th id="modified"  style="border:none">
					<a href="javascript:document.getElementById('sakai_action').value='doSort';document.getElementById('collectionId').value='$collectionId';document.getElementById('criteria').value='last modified';document.getElementById('showForm').submit();"
						title= "$clang.getString('sh.sortdate')">
						$clang.getString("gen.last1")
						#if ($currentSortedBy.equals($resourceProperties.NamePropModifiedDate)) 
							#if ($currentSortAsc.equals("true")) 
								<img src = "#imageLink("sakai/sortascending.gif")" border="0"  title ="$clang.getString('sh.sortdateas')"  alt ="$clang.getString('sh.sortdateas')" /> 
							#else 
								<img src = "#imageLink("sakai/sortdescending.gif")" border="0" title ="$clang.getString('sh.sortdatedesc')"  alt ="$clang.getString('sh.sortdatedesc')" /> 
							#end 
						#end 
					</a>
				</th>
				<th id="size"  style="border:none">
					<a href="javascript:document.getElementById('sakai_action').value='doSort';document.getElementById('collectionId').value='$collectionId';document.getElementById('criteria').value='size';document.getElementById('showForm').submit();"
						title= "$clang.getString('sh.sortsize')">
						$clang.getString("gen.size")
						#if ($currentSortedBy.equals($resourceProperties.NamePropContentLength)) 
							#if ($currentSortAsc.equals("true")) 
								<img src = "#imageLink("sakai/sortascending.gif")" border="0"  title ="$clang.getString('sh.sortsizeas')"  alt ="$clang.getString('sh.sortsizeas')" /> 
							#else 
								<img src = "#imageLink("sakai/sortdescending.gif")" border="0" title ="$clang.getString('sh.sortsizedesc')"  alt ="$clang.getString('sh.sortsizedesc')" /> 
							#end 
						#end 
					</a>
				</th>
			</tr>
			#set ($addCount=20000)
		  #set ($actionCount=10000)
			
			#set($itemcount = 0)
			#set ($unit ="em")
			#foreach($item in $site)
				#set($qid=$item.id.replaceAll("'","\\'").replaceAll("\"", "&quot;"))
				#set($dqid=$item.id.replaceAll("\"", "&quot;"))
				#if(!$dropboxGroupFiltered || ($item.isDropbox() && $dropboxGroupFilter_groupUsers.contains($item.DropboxOwner)) )
				#set($itemcount = $itemcount + 1)
				
					#set ($addCount=($addCount - 1))
					#set ($actionCount=($actionCount - 1))
				  
				#set ($width = "$!{item.depth}$unit")
				#if ($item.depth==0)	
					#set ($margin="margin-left:0")
				#else
					#set ($margin="margin-left:2em")
					#set ($marginAction="margin-left:4.7em")
				#end
				#if ($item.depth > 3)
					#set($headerDepth = 6)
				#else
					#set($headerDepth = $item.depth + 3)
				#end
				############################### Show top level folder #################
				<tr
					#if ($itemcount % 2==0)
						class="odd#if($item.isSelectedForCopy()) selectedCopy#end#if($item.isSelectedForMove()) selectedMove#end#if(!$item.isAvailable()) inactive#end"
					#else
						class="even#if($item.isSelectedForCopy()) selectedCopy#end#if($item.isSelectedForMove()) selectedMove#end#if(!$item.isAvailable()) inactive#end"
					#end>
					#set ($num=$num + 1)
					<td headers="expansion">
					</td>
					<td headers="checkboxes">
						#if($item.depth > 0 && $item.hasMultipleItemActions())
							<input type="checkbox" name="selectedMembers" id="list$num" 
									#if($selectedItems.contains($item.id))checked="checked"#end
									onclick="#foreach($key in $item.multipleItemActions.keySet())adjustCount(this, '$key');#end"
 									value="$dqid" /><label for="list$num" class="skip">$clang.getString("att.select"): $validator.escapeHtml($item.name)</label>
							#foreach($key in $item.multipleItemActions.keySet())$counter.increment("$key") $counter.increment("selectall")#if($selectedItems.contains($item.id))$counter.increment("${key}selected")#end#end
						#end
					</td>
					<td headers="title" style="text-indent:$width" class="specialLink">
					#if($item.isHot("$!dropboxHighlight")) #set($iconDecor="recentItem") #set($newNote="new") #else  #set($iconDecor="nil")  #set($newNote="")#end 
						<h$headerDepth> 
							#if ($item.canRead())
								#if($item.isCollection())
									<span class="skip">$newNote</span><span class="$iconDecor">
									#if($item.isEmpty() || $item.isTooBig() || $item.depth < 1)
										<img src="#imageLink($item.iconLocation)" border= "0" alt="$item.hoverText" hspace="0" /></span>
									#else
										<a href="#"
											#if($item.isExpanded())
												onclick="javascript:document.getElementById('sakai_action').value='doCollapse_collection';document.getElementById('collectionId').value='$qid';document.getElementById('showForm').submit();"
											#else
												onclick="javascript:document.getElementById('sakai_action').value='doExpand_collection';document.getElementById('collectionId').value='$qid';document.getElementById('showForm').submit();"
											#end
											title= "$item.expandLabel"><img src="#imageLink($item.expandIconLocation)" border= "0" alt="$item.expandLabel"  /></a></span>
									#end
									
								#else
									#if ($item.hasCopyrightAlert())
										## if there is a copyright alert, show the alert page first
										<a href="#" 
											title="$tlang.getString('gen.copycomf') $tlang.getString('gen.type'): $item.hoverText  [$tlang.getString('gen.newwin')]"	
											onclick="openCopyrightWindow('${item.accessUrl}','copyrightAlertWindow','scrollbars=yes,menubar=yes,height=600,width=800,resizable=yes,toolbar=yes,location=yes,status=yes');return false"
										>
									#else
										<a href="${item.accessUrl}" target="${item.target}">
									#end
										<img src="#imageLink($item.iconLocation)" border= "0" alt="$item.hoverText" hspace="0" />
									</a>
								#end
								#if($item.isLocked())
 									<img src = "#imageLink("sakai/lock.gif")" border="0"  alt="$tlang.getString('locked')" />
								#end
								#if ($item.hasCopyrightAlert())
									## if there is a copyright alert, show the alert page first
									<a href="#" 
										title="$tlang.getString('gen.copycomf') $item.hoverText [$tlang.getString('gen.newwin')]"
										onclick="openCopyrightWindow('${item.accessUrl}','copyrightAlertWindow','scrollbars=yes,menubar=yes,height=600,width=800,resizable=yes,toolbar=yes,location=yes,status=yes');return false;">
										$validator.escapeHtml($item.name)
									</a>
									&#169;
								#elseif($item.isCollection())
									<a href="#"
										onclick="javascript:document.getElementById('sakai_action').value='doNavigate';document.getElementById('collectionId').value='$qid';document.getElementById('navRoot').value='$validator.escapeUrl($item.root)';document.getElementById('showForm').submit();"
										title= "$item.hoverText">
										$validator.escapeHtml(${item.name})
									</a>
								#else
									<a href="$item.accessUrl" target="$item.target" title="$item.hoverText">
										$validator.escapeHtml($item.name)
									</a>
								#end
							#else
								 <img src="#imageLink($item.iconLocation)" border="0" alt ="$item.hoverText" hspace="0" />
								#if($item.isLocked())
 									<img src = "#imageLink("sakai/lock.gif")" border="0"  alt="$tlang.getString('locked')" />
								#end
								$validator.escapeHtml($item.name)
								#if ($item.hasCopyrightAlert())
									&#169;
								#end
							#end
							#if ($item.description !="" && $item.description) <a class="toggleDescription" href="#" title="$tlang.getString("list.description.link")"> <img src="#imageLink("/silk/information.png")" alt="$tlang.getString("list.description.link")"/></a><div role="alertdialog" aria-hidden="true" class="descPanel" style="display:none;border:2px solid #ccc;height:auto;background:#fff;padding:3px;position:absolute;top:-1000px;left:-1000px;z-index:100000;width:25%"><div class="descriptionClose" style="text-align:right;padding:2px;">x</div>$validator.escapeHtml($item.description)</div>#end
						</h$headerDepth>	
					</td>
					<td headers="actions1"  style="white-space:nowrap;vertical-align:middle"  class="attach">
						#if($item.pasteActions && !$item.pasteActions.isEmpty())
							#set ($itemsOnLine = 0)
							#foreach($action in $item.pasteActions)
								#if($itemsOnLine > 0)|#end
								<a class=" highlightlink" title="$labeler.getLabel($action) $tlang.getString("paste.here")" href="javascript:document.getElementById('selectedItemId').value='$qid';document.getElementById('rt_action').value='${action.typeId}${ACTION_DELIMITER}$action.id';document.getElementById('sakai_action').value='doDispatchAction';submitform('showForm');"><img src = "#imageLink("silk/page_paste.gif")" border="0"  alt="$labeler.getLabel($action)"/></a> 
								#set ($itemsOnLine = $itemsOnLine + 1)
							#end
						#end
					</td>
					#set ($addCount=($addCount - 1))
					#set ($actionCount=($actionCount - 1))
				
					
					<td headers="actions2"   class="attach">

					#if($item.addActions && !$item.addActions.isEmpty())
							<a href="#" onfocus="document.getElementById('menu-$addCount').style.display='none';"></a>
							<a href="#" onfocus="document.getElementById('menu-$addCount').style.display='block';" class="skip">$tlang.getString("button.startadd")</a>

							<ul style="z-index:$addCount;margin:0;display:block" class="makeMenu">
							<li  class="menuOpen" id="$addCount">
									&nbsp;$tlang.getString("button.add") 
								<img src = "#imageLink("sakai/icon-dropdn.gif")" border="0"  alt="$tlang.getString("button.add")"  class="dropdn"/> 
									<ul  id="menu-$addCount" class="makeMenuChild">
										#foreach($action in $item.addActions)
											<li><a  href="javascript:document.getElementById('selectedItemId').value='$qid';document.getElementById('rt_action').value='${action.typeId}${ACTION_DELIMITER}$action.id';document.getElementById('sakai_action').value='doDispatchAction';submitform('showForm');">$labeler.getLabel($action)</a></li>
										#end
										<li style="height:1px;width:1px;display:inline;">
											<a href="#"  class="skip" onfocus="document.getElementById('menu-$addCount').style.display='none';document.getElementById('last-$addCount').focus()" >$tlang.getString("button.endadd")</a>
										</li>
									</ul>

									</li>

								</ul>

							<a href="#" id="last-$addCount" class="skip"></a>							

							#end

						</td>
					<td headers="actions3"   class="attach">

					#if($item.otherActions && !$item.otherActions.isEmpty())
						<a href="#" onfocus="document.getElementById('menu-$actionCount').style.display='none';" class="skip"></a>
						<a href="#" onfocus="document.getElementById('menu-$actionCount').style.display='block';" class="skip">$tlang.getString("button.startact")</a>
							<ul style="z-index:$actionCount ;margin:0;display:block" class="makeMenu">
								<li class="menuOpen" id="$actionCount">
									&nbsp;$tlang.getString("button.actions")
									<img src = "#imageLink("sakai/icon-dropdn.gif")" border="0"   alt="$tlang.getString("button.actions")" class="dropdn"/>									
									<ul  id="menu-$actionCount"  class="makeMenuChild">
										#foreach($action in $item.otherActions)
											<li>
												<a  href="javascript:document.getElementById('selectedItemId').value='$qid';document.getElementById('rt_action').value='${action.typeId}${ACTION_DELIMITER}$action.id';document.getElementById('sakai_action').value='doDispatchAction';submitform('showForm');">
													$labeler.getLabel($action)
												</a>
											</li>
										#end
										<li style="height:1px;width:1px;display:inline;">
											<a href="#" onfocus="document.getElementById('menu-$actionCount').style.display='none';document.getElementById('last-$actionCount').focus()" style="height:1px;margin:0;padding:0"  class="skip">$tlang.getString("button.endact")</a>
										</li>
									</ul>
								</li>
							</ul>
							<a href="#" id="last-$actionCount" class="skip"></a>		
						#end

						</td>
					#if($item.depth > 0)
						<td headers="access" title="$item.effectiveGroupsLabel">
							#if($item.isPubviewInherited() || $item.isPubview())
								$tlang.getString("access.public")
							#elseif($item.isDropbox())
								$tlang.getString("access.dropbox")
							#elseif($item.effectiveAccess == $GROUP_ACCESS)
								$tlang.getString("access.group")
							#else
								$tlang.getString("access.site")
							#end
						</td>
						<td headers="creator">
							$validator.escapeHtml($item.createdBy)
						</td>
						<td headers="modified">
							$item.ModifiedTime
						</td>
						<td headers="size">
							$item.size
						</td>
					#else
						<td colspan="4">
						</td>
					#end
				</tr>
				#end ## if !$dropboxGroupFiltered || ($item.isDropbox() && $dropboxGroupFilter_groupUsers.contains($item.DropboxOwner)) 
			#end ## foreach $item in $this_site
		
			############################################# Begin "Other sites" section
			#if ("$!atHome" == "$!TRUE")
			#if($allowed_to_see_other_sites)
				#if("$!show_other_sites" == "true")
					<tr>
						<th colspan="10"  style="border:none">
						<h3>
							<a href="javascript:document.getElementById('sakai_action').value='doHideOtherSites';document.getElementById('showForm').submit();"
								title= "$clang.getString('list.hide')">
							##<a href="#toolLink("ResourcesAction" "doHideOtherSites")" title= "$clang.getString('list.hide')">
								<img src="#imageLink("sakai/collapse.gif")" alt="$clang.getString('list.hide')" border="0" align="top" />
								$validator.escapeHtml("$clang.getString('list.hide')")
							</a>
						</h3>
						</th>
					</tr>
					################################################################ Begin Paging widgets
					#if($!allMsgNumber && $allMsgNumberInt && $allMsgNumberInt > 5)
						<tr class="exclude">
							<td colspan="10">
								<div class="navPanel">
								<div class="listNav">
 									<div class="instruction" style="margin-bottom:.3em;">$tlang.getString("viewing") $topMsgPos - $btmMsgPos $tlang.getString("of") $allMsgNumber $tlang.getString("items")</div>
									#if ("$pagesize" != "0")
										#if ($goPPButton == "true")
 											<input type="button" name="List_first" id="List_first" value="|&lt;" title="$clang.getString("gen.first")" onclick="javascript: document.getElementById('sakai_action').value='doList_first';document.getElementById('showForm').submit();" />
										#else
											<input type="button" name="List_first" value="|&lt;" disabled="disabled" />
										#end
										#if ($goPPButton == "true")
 											<input type="button" name="List_prev" id="List_prev" value="&lt;" title="$clang.getString("gen.previous") $pagesize" onclick="javascript: document.getElementById('sakai_action').value='doList_prev';document.getElementById('showForm').submit();" />
										#else
											<input type="button" name="List_prev" value="&lt;" disabled="disabled" />
										#end
									#end
									<!-- $pagesize  "$pagesize" -->
									<select name="selectPageSize" onchange="document.getElementById('sakai_action').value='doChange_pagesize';document.getElementById('showForm').submit();">
										<option value="5"#if("$pagesize" == "5") selected="selected"#end>$tlang.getString("lis.show5")</option>
										<option value="10"#if("$pagesize" == "10") selected="selected"#end>$tlang.getString("lis.show10")</option>
										<option value="20"#if("$pagesize" == "20") selected="selected"#end>$tlang.getString("lis.show20")</option>
										<option value="50"#if("$pagesize" == "50") selected="selected"#end>$tlang.getString("lis.show50")</option>
										<option value="100"#if("$pagesize" == "100") selected="selected"#end>$tlang.getString("lis.show100")</option>
										<option value="200"#if("$pagesize" == "200") selected="selected"#end>$tlang.getString("lis.show200")</option>
									</select>
									#if ("$pagesize" != "0")
										#if ($goNPButton == "true")
 											<input type="button" name="List_next" id="List_next" value="&gt;" title="$clang.getString("gen.next") $pagesize" onclick="javascript: document.getElementById('sakai_action').value='doList_next';document.getElementById('showForm').submit();" />
										#else
											<input type="button" name="List_next" value="&gt;" disabled="disabled" />
										#end
										#if ($goNPButton == "true")
 											<input type="button" name="List_last" id="List_last" value="&gt;|" title="$clang.getString("gen.last")" onclick="javascript: document.getElementById('sakai_action').value='doList_last';document.getElementById('showForm').submit();" />
										#else
											<input type="button" name="List_last" value="&gt;|" disabled="disabled" />
										#end
									#end
								</div></div>
							</td>
						</tr>
					#end
					################################################################ Eng Paging widgets
					#foreach($item in $other_sites)
						#set($qid=$item.id.replaceAll("'","\\'").replaceAll("\"", "&quot;"))
						############################### Show top level folder #################
					#set ($addCount=($addCount - 1))
					#set ($actionCount=($actionCount - 1))
					#set ($width = "$!{item.depth}$unit")
						#if ($item.depth==0)	
							#set ($margin="margin-left:0")
						#else
							#set ($margin="margin-left:2em")
							#set ($marginAction="margin-left:4.7em")
						#end
						#if ($item.depth > 3)
							#set($headerDepth = 6)
						#else
							#set($headerDepth = $item.depth + 3)
						#end
						############################### Show top level folder #################
					<tr
					#if ($itemcount % 2==0)
						class="odd#if($item.isSelectedForCopy()) selectedCopy#end#if($item.isSelectedForMove()) selectedMove#end#if(!$item.isAvailable()) inactive#end"
					#else
						class="even#if($item.isSelectedForCopy()) selectedCopy#end#if($item.isSelectedForMove()) selectedMove#end#if(!$item.isAvailable()) inactive#end"
					#end>

							<td headers="expansion">
							</td>
							<td headers="checkboxes">
								#if($item.depth > 0 && $item.hasMultipleItemActions())
									<input type="checkbox" name="selectedMembers" id="list$num" 
											#if($selectedItems.contains($item.id))checked="checked"#end
											onclick="#foreach($key in $item.multipleItemActions.keySet())adjustCount(this, '$key');#end"
 											value="$item.id" /><label for="list$num" class="skip">$clang.getString("att.select")</label>
									#foreach($key in $item.multipleItemActions.keySet())$counter.increment("$key") $counter.increment("selectall")#if($selectedItems.contains($item.id))$counter.increment("${key}selected")#end#end
								#end
							</td>
							<td headers="title" style="text-indent:$width" class="specialLink">
						#if($item.isHot("$!dropboxHighlight")) #set($iconDecor="recentItem") #set($newNote="new") #else  #set($iconDecor="nil")  #set($newNote="")#end 
								<h$headerDepth> 
									#if ($item.canRead())
										#if($item.isCollection())
										<span class="skip">$newNote</span><span class="$iconDecor">	
											#if($item.isEmpty() || $item.isTooBig())
												<img src="#imageLink($item.iconLocation)" border= "0" alt="$item.hoverText" hspace="0" /></span>
											#else
												<a href="#"
													#if($item.isExpanded())
														onclick="javascript:document.getElementById('sakai_action').value='doCollapse_collection';document.getElementById('collectionId').value='$qid';document.getElementById('showForm').submit();"
													#else
														onclick="javascript:document.getElementById('sakai_action').value='doExpand_collection';document.getElementById('collectionId').value='$qid';document.getElementById('showForm').submit();"
													#end
													title= "$item.expandLabel"><img src="#imageLink($item.expandIconLocation)" border= "0" alt="$item.expandLabel" hspace="0" /></a></span>
											#end
											
										#else
											#if ($item.hasCopyrightAlert())
												## if there is a copyright alert, show the alert page first
												<a href="#" 
													title="$tlang.getString('gen.copycomf') $tlang.getString('gen.type'): $item.hoverText  [$tlang.getString('gen.newwin')]"	
													onclick="openCopyrightWindow('${item.accessUrl}','copyrightAlertWindow','scrollbars=yes,menubar=yes,height=600,width=800,resizable=yes,toolbar=yes,location=yes,status=yes');return false"
												>
											#else
												<a href="${item.accessUrl}" target="${item.target}">
											#end
												<img src="#imageLink($item.iconLocation)" border= "0" alt="$item.hoverText" hspace="0" />
											</a>
										#end
										#if($item.isLocked())
 											<img src = "#imageLink("sakai/lock.gif")" border="0"  alt="$tlang.getString('locked')" />
										#end
										#if ($item.hasCopyrightAlert())
											## if there is a copyright alert, show the alert page first
											<a href="#" 
												title="$tlang.getString('gen.copycomf') $item.hoverText [$tlang.getString('gen.newwin')]"
												onclick="openCopyrightWindow('${item.accessUrl}','copyrightAlertWindow','scrollbars=yes,menubar=yes,height=600,width=800,resizable=yes,toolbar=yes,location=yes,status=yes');return false;">
												$validator.escapeHtml($item.name)
											</a>
											&#169;
										#elseif($item.isCollection())
											<a href="#"
												onclick="javascript:document.getElementById('sakai_action').value='doNavigate';document.getElementById('collectionId').value='$qid';document.getElementById('navRoot').value='$validator.escapeUrl($item.root)';document.getElementById('showForm').submit();"
												title= "$item.hoverText">
												$validator.escapeHtml(${item.name})
											</a>
										#else
											<a href="$item.accessUrl" target="$item.target" title="$item.hoverText">
												$validator.escapeHtml($item.name)
											</a>
										#end
									#else
										 <img src="#imageLink($item.iconLocation)" border="0" alt ="$item.hoverText" hspace="0" />
										#if($item.isLocked())
 											<img src = "#imageLink("sakai/lock.gif")" border="0"  alt="$tlang.getString('locked')" />
										#end
										$validator.escapeHtml($item.name)
										#if ($item.hasCopyrightAlert())
											&#169;
										#end
									#end
									#if ($item.description !="" && $item.description) <a class="toggleDescription" href="#" title="$tlang.getString("list.description.link")"> <img src="#imageLink("/silk/information.png")" alt="$tlang.getString("list.description.link")"/></a><div role="alertdialog" aria-hidden="true" class="descPanel" style="display:none;border:2px solid #ccc;height:auto;background:#fff;padding:3px;position:absolute;top:-1000px;left:-1000px;z-index:100000;width:25%"><div class="descriptionClose" style="text-align:right;padding:2px;">x</div>$validator.escapeHtml($item.description)</div>#end
								</h$headerDepth>	
							</td>
							<td headers="actions1"  class="attach" style="white-space:nowrap;vertical-align:middle">
								#if($item.pasteActions && !$item.pasteActions.isEmpty())
									#set ($itemsOnLine = 0)
									#foreach($action in $item.pasteActions)
										#if($itemsOnLine > 0)|#end
										<a class=" highlightlink" title="$labeler.getLabel($action) $tlang.getString("paste.here")" href="javascript:document.getElementById('selectedItemId').value='$qid';document.getElementById('rt_action').value='${action.typeId}${ACTION_DELIMITER}$action.id';document.getElementById('sakai_action').value='doDispatchAction';submitform('showForm');"><img src = "#imageLink("silk/page_paste.gif")" border="0"  alt="$labeler.getLabel($action)"/></a> 
										#set ($itemsOnLine = $itemsOnLine + 1)
									#end
								#end
							</td>
							<td headers="actions2"   class="attach">
								#if($item.addActions && !$item.addActions.isEmpty())
									<a href="#" onfocus="document.getElementById('menu-$addCount').style.display='none';"></a>
									<a href="#" onfocus="document.getElementById('menu-$addCount').style.display='block';" class="skip">$tlang.getString("button.startadd")</a>
									<ul style="z-index:$addCount;margin:0;display:block" class="makeMenu">
										<li class="menuOpen" id="$addCount">
											&nbsp;$tlang.getString("button.add")
											<img src = "#imageLink("sakai/icon-dropdn.gif")" border="0"  alt="$tlang.getString("button.add")" class="dropdn"/>
											<ul  id="menu-$addCount" class="makeMenuChild">
							    #foreach($action in $item.addActions)
												<li>
													<a  href="javascript:document.getElementById('selectedItemId').value='$qid';document.getElementById('rt_action').value='${action.typeId}${ACTION_DELIMITER}$action.id';document.getElementById('sakai_action').value='doDispatchAction';submitform('showForm');">$labeler.getLabel($action)</a>
												</li>
							    #end
										<li style="height:1px;width:1px;display:inline;">
													<a href="#" onfocus="document.getElementById('menu-$addCount').style.display='none';document.getElementById('last-$addCount').focus()" style="height:1px;margin:0;padding:0" class="skip">$tlang.getString("button.endadd")</a>
												</li>
											</ul>
										</li>
									</ul>
									<a href="#" id="last-$addCount" style="height:1px;margin:0;padding:0" class="skip"></a>
								#end

								</td>
							<td headers="actions3" class="attach">
							#if($item.otherActions && !$item.otherActions.isEmpty())
									<a href="#" onfocus="document.getElementById('menu-$actionCount').style.display='none';"></a>
									<a href="#" onfocus="document.getElementById('menu-$actionCount').style.display='block';"  class="skip">$tlang.getString("button.startact")</a>
									<ul style="z-index:$actionCount;margin:0;display:block" class="makeMenu" >
										<li class="menuOpen" id="$actionCount">
											&nbsp;$tlang.getString("button.actions")
											<img src = "#imageLink("sakai/icon-dropdn.gif")" border="0"   alt="$tlang.getString("button.actions")"  class="dropdn"/>
											<ul  id="menu-$actionCount" class="makeMenuChild">
												#foreach($action in $item.otherActions)
													<li>
														<a  href="javascript:document.getElementById('selectedItemId').value='$qid';document.getElementById('rt_action').value='${action.typeId}${ACTION_DELIMITER}$action.id';document.getElementById('sakai_action').value='doDispatchAction';submitform('showForm');">
															$labeler.getLabel($action)
														</a>
													</li>
												#end
										<li style="height:1px;width:1px;display:inline;">
 													<a href="#" onfocus="document.getElementById('menu-$actionCount').style.display='none';document.getElementById('last-$actionCount').focus()" style="height:1px;margin:0;padding:0" title="$tlang.getString("button.endact")" class="skip">$tlang.getString("button.endact")</a>
												</li>
											</ul>
								  	</li>
									</ul>
									<a href="#" id="last-$actionCount" ></a>
								#end

							</td>
							#if($item.depth > 0)
								<td headers="access" title="$item.effectiveGroups">
									#if($item.isPubviewInherited() || $item.isPubview())
										$tlang.getString("access.public")
									#elseif($item.isInDropbox())
										$tlang.getString("access.dropbox")
									#elseif($item.effectiveAccess == $INHERITED_ACCESS || $item.effectiveAccess == $SITE_ACCESS)
										$tlang.getString("access.site")
									#elseif($item.effectiveAccess == $GROUP_ACCESS)
										$tlang.getString("access.group")
									#end
								</td>
								<td headers="creator">
									$validator.escapeHtml($item.createdBy)
								</td>
								<td headers="modified">
									$item.ModifiedTime
								</td>
								<td headers="size">
									$item.size
								</td>
							#else
								<td colspan="4">
								</td>
							#end
						</tr>
					#end ## foreach $root in $other_sites
	
				#else
					<tr>
						<th colspan="10"  style="border:none">
						<h3>
							<a href="javascript:document.getElementById('sakai_action').value='doShowOtherSites';document.getElementById('showForm').submit();"
								title= "$clang.getString('list.show')">
								<img src="#imageLink("sakai/expand.gif")" alt="$clang.getString('list.show')" border="0" align="top" />
								$validator.escapeHtml("$clang.getString('list.show')")
							</a>
						</h3>
						</th>
					</tr>
				#end
			#end
			#end
			############################################# end of "Other sites" section 
		
		</table>
		<div id="bottompadding" style="height:12em"> </div> 
		
		#foreach($key in $listActions.keySet())
			<input type="hidden" id="${key}-count" value="$counter.getValue("${key}selected")" />
		#end		
	</form>						
</div>
<script language="JavaScript" type="text/JavaScript">
	<!--
		#foreach($key in $listActions.keySet())
			#if($counter.getValue("${key}selected") > 0)
				document.getElementById("${key}-button").disabled = false;
			#end
		#end
		#if($counter.getValue("selectall") > 0)
			document.getElementById("selectall").disabled = false;
		#end
		function openCopyrightWindow(theURL,winName,winSettings) 
		{ 
		  window.open(theURL,winName,winSettings);
		  return false;
		}
		function toggleSelectAll(caller, elementName)
		{
			var newValue = caller.checked;
			var elements = document.getElementsByName(elementName);
			
			if(elements)
			{
				for(var i = 0; i < elements.length; i++)
				{
					elements[i].checked = newValue;
				}
			}
			
			if(newValue == true)
			{
				caller.title = "$clang.getString("list.unselect")";
				#foreach($key in $listActions.keySet())
					var ${key}_button = document.getElementById("${key}-button");
					if(${key}_button)
					{
						${key}_button.disabled = false;
						${key}_button.className = 'enabled';
					}
					document.getElementById("${key}-count").value = "$counter.getValue("$key")";
				#end
			}
			else
			{
				caller.title = "$clang.getString("list.select")";
				#foreach($key in $listActions.keySet())
					var ${key}_button = document.getElementById("${key}-button");
					if(${key}_button)
					{
						${key}_button.disabled = true;
						${key}_button.className = 'disabled';
					}
					document.getElementById("${key}-count").value = "0";
				#end
			}
		}
		
		function adjustCount(caller, key)
		{
			var counter = document.getElementById(key + "-count");
			var button = document.getElementById(key + "-button");
			
			if(caller && caller.checked && caller.checked == true)
			{
				counter.value = parseInt(counter.value) + 1;
			}
			else
			{
				counter.value = parseInt(counter.value) - 1;
			}
	
			if(button)
			{
				if(counter.value > 0)
				{
					button.disabled = false;
					button.className='enabled';
				}
				else
				{
					button.disabled = true;
					button.className='disabled';
				}
			}
		}
		
		function disableLinks()
		{
			if(document.getElementsByName)
			{
				var enabledLinks = document.getElementsByName("enabledActionLinks");
				var disabledLinks = document.getElementsByName("disabledActionLinks");
				if(enabledLinks)
				{
					for(var i = 0; i < enabledLinks.length; i++)
					{
						//enabledLinks[i].innerHTML = disabledLinks[i].innerHTML;
						enabledLinks[i].style.display="none";
						disabledLinks[i].style.display="block";
					}
				}			
			}
		}
		function submitform(id)
		{
			var theForm = document.getElementById(id);
			if(theForm && theForm.onsubmit)
			{
				theForm.onsubmit();
			}
			if(theForm && theForm.submit)
			{
				theForm.submit();
			}
		}
	//-->
</script>

	
